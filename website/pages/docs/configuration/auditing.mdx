---
layout: docs
page_title: audit Stanza - Agent Configuration
sidebar_title: audit
description: >-
  The "audit" stanza configures the Nomad agent to configure Audit Logging
  behavior. This is an Enterprise-only feature.
---

# `audit` Stanza

<Placement groups={['audit']} />

The `audit` stanza configures the Nomad agent to configure Audit logging behavior.
Audit logging is an Enterprise-only feature.

When enabled, each HTTP request made to a nomad agent (client or server) will
generate two audit log entries. These two entries correspond to a stage,
OperationReceived and OperationComplete. Audit logging will generate a 
OperationReceived event before the request is processed. An OperationComplete
event will be sent after the request has been processed, but before the response
body is returned to the end user.

```hcl
audit {
  enabled = true
}
```

## `audit` Parameters

- `enabled` `(bool: false)` - Specifies if audit logging should be enabled.
  When enabled, audit logging will occur for every request, unless it is
  filtered by a `filter`.

- `sink` <code>([sink](#sink-stanza): default)</code> - Configures a sink
  for audit logs to be sent to.

- `filter` <code>([filter](#filter-stanza): nil)</code> - Configures a filter
  to exclude matching events from being sent to audit logging sinks.

### `sink` Stanza

The `sink` stanza is used to make audit logging sinks for events to be 
sent to. Currently only a single sink is supported.

The key of the stanza corresponds to the name of the sink which is only used 
for logging purposes

```hcl
  sink "audit" {
    type               = "file"
    delivery_guarantee = "enforced"
    format             = "json"
    path               = "/var/lib/nomad/audit/audit.log"
    rotate_bytes       = 100
    rotate_duration    = "24h"
    rotate_max_files   = 10
  }
```

By default, if no sink stanza is given the following default will be used.

```hcl
  sink "audit" {
    type               = "file"
    delivery_guarantee = "enforced"
    format             = "json"
    path               = "[data_dir]/audit/audit.log"
  }
```

#### `sink` Parameters

- `type` `(string: "file", required)` - Specifies the type of sink to create.
  Currently only `"file"` type is supported.

- `delivery_guarantee` `(string: "enforced", required)` - Specifies the 
  delivery guarantee that will be made for each audit log entry. Available
  options are `"enforced"` and `"best-effort"`. `"enforced"` will prevent
  hault request execution if the audit log event fails to be written it's sink.
  `"best-effort"` will not hault request execution, meaning a request could
  potentially be un-audited.

- `format` `(string: "json", required)` - Specifies the output format to be 
  sent to a sink. Currently only `"json"` format is supported.

- `path` `(string: "[data_dir]/audit/audit.log")` - Specifies the path and file
  name to use for the audit log. By default Nomad will use it's configured 
  [`data_dir`](/docs/configuration#data_dir) for a combined path of 
  `/data_dir/audit/audit.log`. If `rotate_bytes` or `rotate_duration` are set
  file rotation will occur. In this case the filename will be post-fixed with
  `"filename-{timestamp}.log"`

- `rotate_bytes` `(int: 0)` - Specifies the number of bytes that should be
  written to an audit log before it needs to be rotated. Unless specified,
  there is no limit to the number of bytes that can be written to a log file.

- `rotate_duration` `(duration: "24h")` - Specifies the maximum duration a
  audit log should be written to before it needs to be rotated. Must be a
  duration value such as 30s.

- `rotate_max_files` `(int: 0)` - Specifies the maximum number of older log
  file archives to keep. If 0 no files are ever deleted.

### `filter` Stanza

The `filter` stanza is used to create filters to filter *out* matching events
from being written to the audit log. By default, all events will be sent to an
audit log for all stages (OperationReceived and OperationComplete). Filters
are useful for operators who want to limit the performance impact of audit 
logging as well as reducing the amount of events generated.

`endpoints`, `stages`, and `operations` support [globbed pattern](https://github.com/ryanuber/go-glob/blob/master/README.md#example) matching.

```hcl
# Filter all requests and all stages for /ui/ and /v1/agent/health
filter "default" {
  type       = "HTTPEvent"
  endpoints  = ["/ui/", "/v1/agent/health"]
  stages     = ["*"]
  operations = ["*"]
}

# Filter OperationReceived GET requests for all endpoints
filter "OperationReceived GETs" {
  type       = "HTTPEvent"
  endpoints  = ["*"]
  stages     = ["OperationReceived"]
  operations = ["GET"]
}
```

#### `filter` Parameters

- `type` `(string: "HTTPEvent", required)` - Specifies the type of filter to 
  create. Currently only HTTPEvent is supported.

- `endpoints` `(array<string>: [])` - Specifies the list of endpoints to apply
  the filter to.

- `stages` `(array<string>: [])` - Specifies the list of stages 
  (`"OperationReceived"`, `"OperationComplete"`, `"*"`) to apply the filter to
  for a matching endpoint.

- `operations` `(array<string>: [])` - Specifies the list of operations to
  apply the filter to for a matching endpoint. For HTTPEvent types this 
  corresponds to an HTTP verb (GET, PUT, POST, DELETE...).

